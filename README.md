# PkuAutoSubmit

参考PKUAutoSubmit写的园区往返申请自动填写程序

## 版本更新

### v20220301

非必要更新，增加了重试功能，由于报备网的加载等可能出现问题，现在报备失败后会重试，五次尝试均失败才会报错。推荐大家更新。

现在，如果你开通了微信提醒，报备成功和失败后均会收到微信提醒，提醒的标题分别为“报备成功”和“[请注意]报备失败”

整理并精简了代码。

#### 请注意：2022.3.14起政策更新，每周出校≥4天的，需要在下一周初接受核酸检测，因此请务必检查自己的自动报备程序是否超过了每周四日。如果不是确定每周固定时间段出校的，建议取消自动报备，非必要不出校，遵守学校与北京市的防疫政策。

#### 重要提醒：克隆或更新本仓库之后请务必不要忘记改config.ini以及workflow下的corn表达式！！

## 如何运行自动报备

熟悉Github的大佬们请无视掉本节内容~ 

因为是在Github提供的Linux服务器上运行的，不需要在本地配环境，所以以下内容适用于任何系统的用户。

0. （可选）右上角点个星星吧，不要下次一定嘛~

1. 首先你需要有一个Github账号，如果你现在还没有登录，就赶紧点击右上角登录Github吧！推荐使用edu邮箱注册。

2. （可选）然后如果你想要在每天自动报备后能够收到成功的提醒，那么可以在[虾推啥](http://www.xtuis.cn/)用微信扫码登录，得到一个SENDKEY

3. 然后点击右上角的“Fork”，将该仓库分支到你自己，稍等片刻后，现在你应该在【你的ID/PKUAutoSubmit】这个仓库里了。（当然，如果您不是github萌新，完全可以把代码clone在任何机器运行）

4. 然后在【你的ID/PKUAutoSubmit_online】下面那一栏里找到 Settings ，点击，在左侧找到Secrets，点击

    点击右侧New Repository secret，然后添加 ID（大写的），然后输入你的学号

    再点击右侧New Repository secret，然后添加 PASSWORD（大写的），然后输入你的密码。【如果你的密码里有特殊字符如()/\, 请用双引号将你的密码包裹起来，即在value一栏输入："yourpassword"】

    再点击右侧New Repository secret，然后添加 MAIL_ADDRESS（大写的），然后输入你的电子邮箱地址

    再点击右侧New Repository secret，然后添加 PHONE_NUMBER（大写的），然后输入你的手机号码

    再点击右侧New Repository secret，然后添加 SENDKEY（大写的），然后输入你的SENDKEY（如果你不需要微信通知，就随便写点啥都行，比如填写一个0。不过虽然用不到这个字段，但要有这个字段）

    <font size=5>*secret是github的保密字段，在这里填写的内容，在填写后没人能够看到它是什么，包括你自己，你只能修改它。*
    
5. 当前我的仓库的默认值为每天上午11点，如果你想修改这个频率，请务必注意修改.github/workflows/main.yml Line 6的corn表达式来更改为你想要的报备频率。 

6. 然后在【你的ID/PKUAutoSubmit】下面那一栏里找到 Actions，点进去，

    可能会弹出提示框，点击“Enable...”允许脚本运行，

    从左侧列表里选中PKUAutoSubmit，

    可能上面还是会有一条提示说是否允许脚本在fork的仓库上运行，点击“Enable...”就好，

    这个时候，脚本应该已经可以按照你设定的频率自动运行了，但是推荐手动测试一下，手动测试点击右侧的“Run workflow” - “Run workflow”就可以手动运行一次了。

## 如何修改自动报备的频率
    
通过修改.github/workflows/main.yml Line 6的corn表达式来实现。
    
默认值是 '0 1 * * 1,2,3,4,5'，这表示工作日UTC 1:00，即北京时间上午9点，执行出校和入校报备各一次。
    
可以通过编辑单引号内的五个字段来改变报备频率，这五个字段分别表示UTC时间的分钟、小时、日期、月份、星期几，比如 '0 0,2 * * 1,2,3,4,5' 表示周一到周五的北京时间八点和十点执行。有关corn表达式的更多信息，可以自行利用搜索引擎搜索。

## 如何取消自动报备

Settings -> Actions -> Disabled Actions
    
也可以直接删除你fork的仓库

也可以删除./github/workflows

也可以编辑./github/workflows/main.yml, 在Line5 Line6前面加个“#”号，注释掉它们
    
## 说明

本代码只供参考学习，使用者应当对自己所填写的内容负责。

本品的开发初衷是拯救需要每天出入校的科研党，利人利己，欢迎大家扩散。如果有任何问题或警告，我会立即删除该项目。

